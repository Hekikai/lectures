**Бандлинг**

Большинство React-приложений "собирают" свои файлы такими инструментами, как Webpack, Rollup или Browserify. Сборка (или «бандлинг») — это процесс выявления импортированных файлов и объединения их в один «собранный» файл (часто называемый «bundle» или «бандл»). Этот бандл после подключения на веб-страницу загружает всё приложение за один раз.

Если вы используете [Create React App](https://create-react-app.dev/), [Next.js](https://github.com/zeit/next.js/), [Gatsby](https://www.gatsbyjs.org/) или похожие инструменты, то у вас уже будет настроенный Webpack для бандлинга приложения.

Иначе, вам нужно будет настроить webpack самостоятельно. Для этого ознакомьтесь со страницами по [установке](https://webpack.js.org/guides/installation/) и [началу работы](https://webpack.js.org/guides/getting-started/) в документации по Webpack.

**Разделение кода**

По мере роста приложения, а также включения сторонних библиотек, бандл будет разрастаться. И чтобы сделать его не столько большим, сколько "удобным" для загрузки в браузере, нужно начать "разделять" наш бандл.

*import()*

Лучший способ внедрить разделение кода в приложение — использовать синтаксис динамического импорта: `import()`.

До:

```js
import { add } from './math';

console.log(add(16,26));
```

После:

```js
import('./math').then(math => {
	console.log(math(16,26));
})
```

Когда Webpack сталкивается с таким синтаксисом, он автоматически начинает разделять код вашего приложения. Если вы используете Create React App, то всё уже настроено и вы можете сразу [начать использовать](https://create-react-app.dev/docs/code-splitting/) синтаксис динамического импорта. Он также поддерживается «из коробки» в [Next.js](https://nextjs.org/docs/advanced-features/dynamic-import).

*React.lazy*

Функция `React.lazy` позволяет рендерить динамический импорт как обычный компонент.

До:

```js
import OtherComponent from './OtherComponent';
```

После:

```js
const OtherComponent = React.lazy(() => import('./OtherComponent'));
```

Она автоматически загрузит бандл, содержащий `OtherComponent`, когда этот компонент будет впервые отрендерен.

`React.lazy` принимает функцию, которая должна вызвать динамический `import()`. Результатом возвращённого Promise является модуль, который экспортирует по умолчанию React-компонент (`export default`).

*Задержка*

Компонент с ленивой загрузкой *должен быть* обёрнут в компонент `<Suspense>`, который позволяет показать запасное содержимое (например, индикатор загрузки) пока происходит загрузка ленивого компонента.

```js
import React, { Suspense } from 'react';

const OtherComponent = React.lazy(() => import('./OtherComponent'));

function MyComponent() {
  return (
    <div>
      <Suspense fallback={<div>Загрузка...</div>}>
        <OtherComponent />
      </Suspense>
    </div>
  );
}
```

Проп `fallback` принимает любой React-элемент, который вы хотите показать, пока происходит загрузка компонента. Компонент `Suspense` можно разместить в любом месте над ленивым компонентом. Кроме того, можно обернуть несколько ленивых компонентов одним компонентом `Suspense`.

*Именованный экспорт*

`React.lazy` в настоящее время поддерживает только экспорт по умолчанию. Если модуль, который требуется импортировать, использует именованный экспорт, можно создать промежуточный модуль, который повторно экспортирует его как модуль по умолчанию. Это гарантирует работоспособность tree shaking — механизма устранения неиспользуемого кода.

```js
// ManyComponents.js
export const MyComponent = /* ... */;
export const MyUnusedComponent = /* ... */;
```

```js
// MyComponent.js
export { MyComponent as default } from "./ManyComponents.js";
```

```js
// MyApp.js
import React, { lazy } from 'react';
const MyComponent = lazy(() => import("./MyComponent.js"));
```

